function [A,B] = deriveLinSys(y,u,P)

%This function returns A and B matrix: Linearized dynamics at nominal
%trajectory y and a ref input i.e [f_c,wx,wy,wz] remember this is for the
%high level controller and other params P

% get quad specific params
D = P.D;
m = P.m;

p = reshape(y(1:3),[3 1]);
q = reshape(y(4:7),[4 1]);
v = reshape(y(8:10),[3 1]);
nq = norm(q);
% q*q.'
ddqu_dq = (eye(4) - (nq^-2)*q*q.')*(nq^-1) ;

c = u(1);
wx = u(2);
wy = u(3);
wz = u(4);


qw = q(1);
qx = q(2);
qy = q(3);
qz = q(4);

ddp_dv = eye([3 3]);
ddq_dq = 0.5*[ 0, -wx, -wy, -wz;...
              wx,   0,  wz, -wy;...
              wy, -wz,   0,  wx;...
              wz,  wy, -wx,   0]*ddqu_dq;
ddq_dw = 0.5*[-qx, -qy, -qz;...
               qw, -qz, -qy;...
               qz,  qw,  qx;...
              -qy,  qx,  qw];
ddc_dq = 2*c*[ qy,  qz,  qw, qx;...
              -qx, -qw,  qz, qy;...
               qw, -qx, -qy, qz]*ddqu_dq;
ddv_dc = -[            qw*qy + qx*qz;...
                      qy*qz - qw*qx;...
          qw^2 - qx^2 - qy^2 + qz^2]; 
      
R=quater_rot(q);

ddrg_v= -(R*D*R'*(norm(v)*eye(3)+(v*v')/norm(v)))/m; %also jacobian of vdot wrt v     
vx=v(1);
vy=v(2);
vz=v(3);
dx=D(1);
dy=D(2);
dz=D(3);
ddrg_q=[ ((qw^2/(abs(qw)^2 + abs(qx)^2 + abs(qy)^2 + abs(qz)^2) - 1)*(vy*(2*dy*qw*(2*qw*qz - 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dx*qw*(2*qw*qz + 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dz*qx*(2*qw*qy + 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dz*qy*(2*qw*qx - 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dx*qz*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 + qx^2 - qy^2 - qz^2) + 2*dy*qz*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 + qy^2 - qz^2)) + vz*(2*dx*qw*(2*qw*qy - 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dy*qx*(2*qw*qz - 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dz*qw*(2*qw*qy + 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dy*qz*(2*qw*qx + 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dx*qy*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 + qx^2 - qy^2 - qz^2) - 2*dz*qy*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 - qy^2 + qz^2)) - vx*(4*dy*qz*(2*qw*qz - 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 4*dz*qy*(2*qw*qy + 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 4*dx*qw*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 + qx^2 - qy^2 - qz^2))))/(abs(qw)^2 + abs(qx)^2 + abs(qy)^2 + abs(qz)^2)^(1/2) + (qw*qy*(vy*(2*dx*qy*(2*qw*qz + 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dz*qw*(2*qw*qx - 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dy*qy*(2*qw*qz - 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dz*qz*(2*qw*qy + 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dx*qx*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 + qx^2 - qy^2 - qz^2) - 2*dy*qx*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 + qy^2 - qz^2)) - vz*(2*dx*qy*(2*qw*qy - 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dy*qx*(2*qw*qx + 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dy*qz*(2*qw*qz - 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dz*qy*(2*qw*qy + 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dx*qw*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 + qx^2 - qy^2 - qz^2) + 2*dz*qw*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 - qy^2 + qz^2)) + vx*(4*dy*qx*(2*qw*qz - 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 4*dz*qw*(2*qw*qy + 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 4*dx*qy*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 + qx^2 - qy^2 - qz^2))))/(abs(qw)^2 + abs(qx)^2 + abs(qy)^2 + abs(qz)^2)^(3/2) - (qw*qx*(vy*(2*dx*qx*(2*qw*qz + 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dy*qx*(2*qw*qz - 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dz*qw*(2*qw*qy + 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dz*qz*(2*qw*qx - 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dx*qy*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 + qx^2 - qy^2 - qz^2) + 2*dy*qy*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 + qy^2 - qz^2)) - vz*(2*dx*qx*(2*qw*qy - 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dy*qw*(2*qw*qz - 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dy*qy*(2*qw*qx + 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dz*qx*(2*qw*qy + 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dx*qz*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 + qx^2 - qy^2 - qz^2) - 2*dz*qz*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 - qy^2 + qz^2)) + vx*(4*dz*qz*(2*qw*qy + 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 4*dy*qy*(2*qw*qz - 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 4*dx*qx*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 + qx^2 - qy^2 - qz^2))))/(abs(qw)^2 + abs(qx)^2 + abs(qy)^2 + abs(qz)^2)^(3/2) - (qw*qz*(vz*(2*dx*qz*(2*qw*qy - 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dy*qw*(2*qw*qx + 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dy*qy*(2*qw*qz - 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dz*qz*(2*qw*qy + 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dx*qx*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 + qx^2 - qy^2 - qz^2) + 2*dz*qx*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 - qy^2 + qz^2)) - vy*(2*dx*qz*(2*qw*qz + 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dz*qx*(2*qw*qx - 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dy*qz*(2*qw*qz - 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dz*qy*(2*qw*qy + 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dx*qw*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 + qx^2 - qy^2 - qz^2) + 2*dy*qw*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 + qy^2 - qz^2)) + vx*(4*dy*qw*(2*qw*qz - 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 4*dz*qx*(2*qw*qy + 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 4*dx*qz*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 + qx^2 - qy^2 - qz^2))))/(abs(qw)^2 + abs(qx)^2 + abs(qy)^2 + abs(qz)^2)^(3/2), (qw*qx*(vy*(2*dy*qw*(2*qw*qz - 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dx*qw*(2*qw*qz + 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dz*qx*(2*qw*qy + 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dz*qy*(2*qw*qx - 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dx*qz*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 + qx^2 - qy^2 - qz^2) + 2*dy*qz*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 + qy^2 - qz^2)) + vz*(2*dx*qw*(2*qw*qy - 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dy*qx*(2*qw*qz - 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dz*qw*(2*qw*qy + 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dy*qz*(2*qw*qx + 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dx*qy*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 + qx^2 - qy^2 - qz^2) - 2*dz*qy*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 - qy^2 + qz^2)) - vx*(4*dy*qz*(2*qw*qz - 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 4*dz*qy*(2*qw*qy + 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 4*dx*qw*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 + qx^2 - qy^2 - qz^2))))/(abs(qw)^2 + abs(qx)^2 + abs(qy)^2 + abs(qz)^2)^(3/2) - ((qx^2/(abs(qw)^2 + abs(qx)^2 + abs(qy)^2 + abs(qz)^2) - 1)*(vy*(2*dx*qx*(2*qw*qz + 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dy*qx*(2*qw*qz - 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dz*qw*(2*qw*qy + 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dz*qz*(2*qw*qx - 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dx*qy*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 + qx^2 - qy^2 - qz^2) + 2*dy*qy*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 + qy^2 - qz^2)) - vz*(2*dx*qx*(2*qw*qy - 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dy*qw*(2*qw*qz - 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dy*qy*(2*qw*qx + 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dz*qx*(2*qw*qy + 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dx*qz*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 + qx^2 - qy^2 - qz^2) - 2*dz*qz*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 - qy^2 + qz^2)) + vx*(4*dz*qz*(2*qw*qy + 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 4*dy*qy*(2*qw*qz - 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 4*dx*qx*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 + qx^2 - qy^2 - qz^2))))/(abs(qw)^2 + abs(qx)^2 + abs(qy)^2 + abs(qz)^2)^(1/2) + (qx*qy*(vy*(2*dx*qy*(2*qw*qz + 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dz*qw*(2*qw*qx - 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dy*qy*(2*qw*qz - 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dz*qz*(2*qw*qy + 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dx*qx*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 + qx^2 - qy^2 - qz^2) - 2*dy*qx*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 + qy^2 - qz^2)) - vz*(2*dx*qy*(2*qw*qy - 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dy*qx*(2*qw*qx + 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dy*qz*(2*qw*qz - 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dz*qy*(2*qw*qy + 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dx*qw*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 + qx^2 - qy^2 - qz^2) + 2*dz*qw*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 - qy^2 + qz^2)) + vx*(4*dy*qx*(2*qw*qz - 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 4*dz*qw*(2*qw*qy + 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 4*dx*qy*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 + qx^2 - qy^2 - qz^2))))/(abs(qw)^2 + abs(qx)^2 + abs(qy)^2 + abs(qz)^2)^(3/2) - (qx*qz*(vz*(2*dx*qz*(2*qw*qy - 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dy*qw*(2*qw*qx + 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dy*qy*(2*qw*qz - 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dz*qz*(2*qw*qy + 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dx*qx*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 + qx^2 - qy^2 - qz^2) + 2*dz*qx*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 - qy^2 + qz^2)) - vy*(2*dx*qz*(2*qw*qz + 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dz*qx*(2*qw*qx - 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dy*qz*(2*qw*qz - 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dz*qy*(2*qw*qy + 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dx*qw*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 + qx^2 - qy^2 - qz^2) + 2*dy*qw*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 + qy^2 - qz^2)) + vx*(4*dy*qw*(2*qw*qz - 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 4*dz*qx*(2*qw*qy + 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 4*dx*qz*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 + qx^2 - qy^2 - qz^2))))/(abs(qw)^2 + abs(qx)^2 + abs(qy)^2 + abs(qz)^2)^(3/2), ((qy^2/(abs(qw)^2 + abs(qx)^2 + abs(qy)^2 + abs(qz)^2) - 1)*(vy*(2*dx*qy*(2*qw*qz + 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dz*qw*(2*qw*qx - 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dy*qy*(2*qw*qz - 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dz*qz*(2*qw*qy + 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dx*qx*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 + qx^2 - qy^2 - qz^2) - 2*dy*qx*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 + qy^2 - qz^2)) - vz*(2*dx*qy*(2*qw*qy - 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dy*qx*(2*qw*qx + 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dy*qz*(2*qw*qz - 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dz*qy*(2*qw*qy + 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dx*qw*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 + qx^2 - qy^2 - qz^2) + 2*dz*qw*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 - qy^2 + qz^2)) + vx*(4*dy*qx*(2*qw*qz - 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 4*dz*qw*(2*qw*qy + 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 4*dx*qy*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 + qx^2 - qy^2 - qz^2))))/(abs(qw)^2 + abs(qx)^2 + abs(qy)^2 + abs(qz)^2)^(1/2) + (qw*qy*(vy*(2*dy*qw*(2*qw*qz - 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dx*qw*(2*qw*qz + 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dz*qx*(2*qw*qy + 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dz*qy*(2*qw*qx - 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dx*qz*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 + qx^2 - qy^2 - qz^2) + 2*dy*qz*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 + qy^2 - qz^2)) + vz*(2*dx*qw*(2*qw*qy - 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dy*qx*(2*qw*qz - 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dz*qw*(2*qw*qy + 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dy*qz*(2*qw*qx + 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dx*qy*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 + qx^2 - qy^2 - qz^2) - 2*dz*qy*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 - qy^2 + qz^2)) - vx*(4*dy*qz*(2*qw*qz - 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 4*dz*qy*(2*qw*qy + 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 4*dx*qw*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 + qx^2 - qy^2 - qz^2))))/(abs(qw)^2 + abs(qx)^2 + abs(qy)^2 + abs(qz)^2)^(3/2) - (qx*qy*(vy*(2*dx*qx*(2*qw*qz + 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dy*qx*(2*qw*qz - 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dz*qw*(2*qw*qy + 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dz*qz*(2*qw*qx - 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dx*qy*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 + qx^2 - qy^2 - qz^2) + 2*dy*qy*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 + qy^2 - qz^2)) - vz*(2*dx*qx*(2*qw*qy - 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dy*qw*(2*qw*qz - 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dy*qy*(2*qw*qx + 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dz*qx*(2*qw*qy + 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dx*qz*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 + qx^2 - qy^2 - qz^2) - 2*dz*qz*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 - qy^2 + qz^2)) + vx*(4*dz*qz*(2*qw*qy + 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 4*dy*qy*(2*qw*qz - 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 4*dx*qx*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 + qx^2 - qy^2 - qz^2))))/(abs(qw)^2 + abs(qx)^2 + abs(qy)^2 + abs(qz)^2)^(3/2) - (qy*qz*(vz*(2*dx*qz*(2*qw*qy - 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dy*qw*(2*qw*qx + 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dy*qy*(2*qw*qz - 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dz*qz*(2*qw*qy + 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dx*qx*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 + qx^2 - qy^2 - qz^2) + 2*dz*qx*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 - qy^2 + qz^2)) - vy*(2*dx*qz*(2*qw*qz + 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dz*qx*(2*qw*qx - 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dy*qz*(2*qw*qz - 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dz*qy*(2*qw*qy + 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dx*qw*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 + qx^2 - qy^2 - qz^2) + 2*dy*qw*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 + qy^2 - qz^2)) + vx*(4*dy*qw*(2*qw*qz - 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 4*dz*qx*(2*qw*qy + 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 4*dx*qz*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 + qx^2 - qy^2 - qz^2))))/(abs(qw)^2 + abs(qx)^2 + abs(qy)^2 + abs(qz)^2)^(3/2), (qw*qz*(vy*(2*dy*qw*(2*qw*qz - 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dx*qw*(2*qw*qz + 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dz*qx*(2*qw*qy + 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dz*qy*(2*qw*qx - 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dx*qz*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 + qx^2 - qy^2 - qz^2) + 2*dy*qz*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 + qy^2 - qz^2)) + vz*(2*dx*qw*(2*qw*qy - 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dy*qx*(2*qw*qz - 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dz*qw*(2*qw*qy + 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dy*qz*(2*qw*qx + 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dx*qy*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 + qx^2 - qy^2 - qz^2) - 2*dz*qy*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 - qy^2 + qz^2)) - vx*(4*dy*qz*(2*qw*qz - 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 4*dz*qy*(2*qw*qy + 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 4*dx*qw*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 + qx^2 - qy^2 - qz^2))))/(abs(qw)^2 + abs(qx)^2 + abs(qy)^2 + abs(qz)^2)^(3/2) - ((qz^2/(abs(qw)^2 + abs(qx)^2 + abs(qy)^2 + abs(qz)^2) - 1)*(vz*(2*dx*qz*(2*qw*qy - 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dy*qw*(2*qw*qx + 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dy*qy*(2*qw*qz - 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dz*qz*(2*qw*qy + 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dx*qx*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 + qx^2 - qy^2 - qz^2) + 2*dz*qx*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 - qy^2 + qz^2)) - vy*(2*dx*qz*(2*qw*qz + 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dz*qx*(2*qw*qx - 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dy*qz*(2*qw*qz - 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dz*qy*(2*qw*qy + 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dx*qw*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 + qx^2 - qy^2 - qz^2) + 2*dy*qw*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 + qy^2 - qz^2)) + vx*(4*dy*qw*(2*qw*qz - 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 4*dz*qx*(2*qw*qy + 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 4*dx*qz*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 + qx^2 - qy^2 - qz^2))))/(abs(qw)^2 + abs(qx)^2 + abs(qy)^2 + abs(qz)^2)^(1/2) + (qy*qz*(vy*(2*dx*qy*(2*qw*qz + 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dz*qw*(2*qw*qx - 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dy*qy*(2*qw*qz - 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dz*qz*(2*qw*qy + 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dx*qx*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 + qx^2 - qy^2 - qz^2) - 2*dy*qx*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 + qy^2 - qz^2)) - vz*(2*dx*qy*(2*qw*qy - 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dy*qx*(2*qw*qx + 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dy*qz*(2*qw*qz - 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dz*qy*(2*qw*qy + 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dx*qw*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 + qx^2 - qy^2 - qz^2) + 2*dz*qw*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 - qy^2 + qz^2)) + vx*(4*dy*qx*(2*qw*qz - 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 4*dz*qw*(2*qw*qy + 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 4*dx*qy*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 + qx^2 - qy^2 - qz^2))))/(abs(qw)^2 + abs(qx)^2 + abs(qy)^2 + abs(qz)^2)^(3/2) - (qx*qz*(vy*(2*dx*qx*(2*qw*qz + 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dy*qx*(2*qw*qz - 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dz*qw*(2*qw*qy + 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dz*qz*(2*qw*qx - 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dx*qy*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 + qx^2 - qy^2 - qz^2) + 2*dy*qy*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 + qy^2 - qz^2)) - vz*(2*dx*qx*(2*qw*qy - 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dy*qw*(2*qw*qz - 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dy*qy*(2*qw*qx + 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dz*qx*(2*qw*qy + 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dx*qz*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 + qx^2 - qy^2 - qz^2) - 2*dz*qz*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 - qy^2 + qz^2)) + vx*(4*dz*qz*(2*qw*qy + 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 4*dy*qy*(2*qw*qz - 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 4*dx*qx*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 + qx^2 - qy^2 - qz^2))))/(abs(qw)^2 + abs(qx)^2 + abs(qy)^2 + abs(qz)^2)^(3/2);
((qw^2/(abs(qw)^2 + abs(qx)^2 + abs(qy)^2 + abs(qz)^2) - 1)*(vx*(2*dy*qw*(2*qw*qz - 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dx*qw*(2*qw*qz + 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dz*qx*(2*qw*qy + 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dz*qy*(2*qw*qx - 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dx*qz*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 + qx^2 - qy^2 - qz^2) + 2*dy*qz*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 + qy^2 - qz^2)) + vz*(2*dx*qy*(2*qw*qz + 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dy*qw*(2*qw*qx + 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dz*qw*(2*qw*qx - 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dx*qz*(2*qw*qy - 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dy*qx*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 + qy^2 - qz^2) + 2*dz*qx*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 - qy^2 + qz^2)) - vy*(4*dx*qz*(2*qw*qz + 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 4*dz*qx*(2*qw*qx - 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 4*dy*qw*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 + qy^2 - qz^2))))/(abs(qw)^2 + abs(qx)^2 + abs(qy)^2 + abs(qz)^2)^(1/2) - (qw*qx*(vx*(2*dx*qx*(2*qw*qz + 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dy*qx*(2*qw*qz - 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dz*qw*(2*qw*qy + 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dz*qz*(2*qw*qx - 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dx*qy*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 + qx^2 - qy^2 - qz^2) + 2*dy*qy*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 + qy^2 - qz^2)) - vz*(2*dx*qy*(2*qw*qy - 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dy*qx*(2*qw*qx + 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dx*qz*(2*qw*qz + 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dz*qx*(2*qw*qx - 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dy*qw*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 + qy^2 - qz^2) + 2*dz*qw*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 - qy^2 + qz^2)) + vy*(4*dx*qy*(2*qw*qz + 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 4*dz*qw*(2*qw*qx - 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 4*dy*qx*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 + qy^2 - qz^2))))/(abs(qw)^2 + abs(qx)^2 + abs(qy)^2 + abs(qz)^2)^(3/2) + (qw*qz*(vx*(2*dx*qz*(2*qw*qz + 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dz*qx*(2*qw*qx - 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dy*qz*(2*qw*qz - 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dz*qy*(2*qw*qy + 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dx*qw*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 + qx^2 - qy^2 - qz^2) + 2*dy*qw*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 + qy^2 - qz^2)) + vz*(2*dx*qw*(2*qw*qy - 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dx*qx*(2*qw*qz + 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dy*qz*(2*qw*qx + 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dz*qz*(2*qw*qx - 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dy*qy*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 + qy^2 - qz^2) - 2*dz*qy*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 - qy^2 + qz^2)) + vy*(4*dz*qy*(2*qw*qx - 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 4*dx*qw*(2*qw*qz + 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 4*dy*qz*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 + qy^2 - qz^2))))/(abs(qw)^2 + abs(qx)^2 + abs(qy)^2 + abs(qz)^2)^(3/2) - (qw*qy*(vz*(2*dy*qy*(2*qw*qx + 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dx*qx*(2*qw*qy - 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dx*qw*(2*qw*qz + 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dz*qy*(2*qw*qx - 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dy*qz*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 + qy^2 - qz^2) + 2*dz*qz*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 - qy^2 + qz^2)) - vx*(2*dx*qy*(2*qw*qz + 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dz*qw*(2*qw*qx - 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dy*qy*(2*qw*qz - 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dz*qz*(2*qw*qy + 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dx*qx*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 + qx^2 - qy^2 - qz^2) - 2*dy*qx*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 + qy^2 - qz^2)) + vy*(4*dx*qx*(2*qw*qz + 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 4*dz*qz*(2*qw*qx - 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 4*dy*qy*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 + qy^2 - qz^2))))/(abs(qw)^2 + abs(qx)^2 + abs(qy)^2 + abs(qz)^2)^(3/2), (qw*qx*(vx*(2*dy*qw*(2*qw*qz - 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dx*qw*(2*qw*qz + 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dz*qx*(2*qw*qy + 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dz*qy*(2*qw*qx - 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dx*qz*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 + qx^2 - qy^2 - qz^2) + 2*dy*qz*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 + qy^2 - qz^2)) + vz*(2*dx*qy*(2*qw*qz + 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dy*qw*(2*qw*qx + 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dz*qw*(2*qw*qx - 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dx*qz*(2*qw*qy - 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dy*qx*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 + qy^2 - qz^2) + 2*dz*qx*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 - qy^2 + qz^2)) - vy*(4*dx*qz*(2*qw*qz + 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 4*dz*qx*(2*qw*qx - 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 4*dy*qw*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 + qy^2 - qz^2))))/(abs(qw)^2 + abs(qx)^2 + abs(qy)^2 + abs(qz)^2)^(3/2) - ((qx^2/(abs(qw)^2 + abs(qx)^2 + abs(qy)^2 + abs(qz)^2) - 1)*(vx*(2*dx*qx*(2*qw*qz + 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dy*qx*(2*qw*qz - 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dz*qw*(2*qw*qy + 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dz*qz*(2*qw*qx - 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dx*qy*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 + qx^2 - qy^2 - qz^2) + 2*dy*qy*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 + qy^2 - qz^2)) - vz*(2*dx*qy*(2*qw*qy - 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dy*qx*(2*qw*qx + 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dx*qz*(2*qw*qz + 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dz*qx*(2*qw*qx - 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dy*qw*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 + qy^2 - qz^2) + 2*dz*qw*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 - qy^2 + qz^2)) + vy*(4*dx*qy*(2*qw*qz + 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 4*dz*qw*(2*qw*qx - 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 4*dy*qx*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 + qy^2 - qz^2))))/(abs(qw)^2 + abs(qx)^2 + abs(qy)^2 + abs(qz)^2)^(1/2) + (qx*qz*(vx*(2*dx*qz*(2*qw*qz + 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dz*qx*(2*qw*qx - 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dy*qz*(2*qw*qz - 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dz*qy*(2*qw*qy + 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dx*qw*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 + qx^2 - qy^2 - qz^2) + 2*dy*qw*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 + qy^2 - qz^2)) + vz*(2*dx*qw*(2*qw*qy - 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dx*qx*(2*qw*qz + 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dy*qz*(2*qw*qx + 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dz*qz*(2*qw*qx - 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dy*qy*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 + qy^2 - qz^2) - 2*dz*qy*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 - qy^2 + qz^2)) + vy*(4*dz*qy*(2*qw*qx - 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 4*dx*qw*(2*qw*qz + 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 4*dy*qz*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 + qy^2 - qz^2))))/(abs(qw)^2 + abs(qx)^2 + abs(qy)^2 + abs(qz)^2)^(3/2) - (qx*qy*(vz*(2*dy*qy*(2*qw*qx + 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dx*qx*(2*qw*qy - 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dx*qw*(2*qw*qz + 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dz*qy*(2*qw*qx - 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dy*qz*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 + qy^2 - qz^2) + 2*dz*qz*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 - qy^2 + qz^2)) - vx*(2*dx*qy*(2*qw*qz + 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dz*qw*(2*qw*qx - 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dy*qy*(2*qw*qz - 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dz*qz*(2*qw*qy + 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dx*qx*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 + qx^2 - qy^2 - qz^2) - 2*dy*qx*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 + qy^2 - qz^2)) + vy*(4*dx*qx*(2*qw*qz + 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 4*dz*qz*(2*qw*qx - 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 4*dy*qy*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 + qy^2 - qz^2))))/(abs(qw)^2 + abs(qx)^2 + abs(qy)^2 + abs(qz)^2)^(3/2), (qw*qy*(vx*(2*dy*qw*(2*qw*qz - 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dx*qw*(2*qw*qz + 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dz*qx*(2*qw*qy + 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dz*qy*(2*qw*qx - 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dx*qz*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 + qx^2 - qy^2 - qz^2) + 2*dy*qz*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 + qy^2 - qz^2)) + vz*(2*dx*qy*(2*qw*qz + 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dy*qw*(2*qw*qx + 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dz*qw*(2*qw*qx - 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dx*qz*(2*qw*qy - 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dy*qx*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 + qy^2 - qz^2) + 2*dz*qx*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 - qy^2 + qz^2)) - vy*(4*dx*qz*(2*qw*qz + 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 4*dz*qx*(2*qw*qx - 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 4*dy*qw*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 + qy^2 - qz^2))))/(abs(qw)^2 + abs(qx)^2 + abs(qy)^2 + abs(qz)^2)^(3/2) - ((qy^2/(abs(qw)^2 + abs(qx)^2 + abs(qy)^2 + abs(qz)^2) - 1)*(vz*(2*dy*qy*(2*qw*qx + 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dx*qx*(2*qw*qy - 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dx*qw*(2*qw*qz + 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dz*qy*(2*qw*qx - 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dy*qz*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 + qy^2 - qz^2) + 2*dz*qz*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 - qy^2 + qz^2)) - vx*(2*dx*qy*(2*qw*qz + 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dz*qw*(2*qw*qx - 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dy*qy*(2*qw*qz - 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dz*qz*(2*qw*qy + 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dx*qx*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 + qx^2 - qy^2 - qz^2) - 2*dy*qx*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 + qy^2 - qz^2)) + vy*(4*dx*qx*(2*qw*qz + 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 4*dz*qz*(2*qw*qx - 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 4*dy*qy*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 + qy^2 - qz^2))))/(abs(qw)^2 + abs(qx)^2 + abs(qy)^2 + abs(qz)^2)^(1/2) - (qx*qy*(vx*(2*dx*qx*(2*qw*qz + 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dy*qx*(2*qw*qz - 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dz*qw*(2*qw*qy + 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dz*qz*(2*qw*qx - 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dx*qy*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 + qx^2 - qy^2 - qz^2) + 2*dy*qy*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 + qy^2 - qz^2)) - vz*(2*dx*qy*(2*qw*qy - 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dy*qx*(2*qw*qx + 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dx*qz*(2*qw*qz + 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dz*qx*(2*qw*qx - 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dy*qw*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 + qy^2 - qz^2) + 2*dz*qw*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 - qy^2 + qz^2)) + vy*(4*dx*qy*(2*qw*qz + 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 4*dz*qw*(2*qw*qx - 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 4*dy*qx*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 + qy^2 - qz^2))))/(abs(qw)^2 + abs(qx)^2 + abs(qy)^2 + abs(qz)^2)^(3/2) + (qy*qz*(vx*(2*dx*qz*(2*qw*qz + 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dz*qx*(2*qw*qx - 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dy*qz*(2*qw*qz - 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dz*qy*(2*qw*qy + 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dx*qw*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 + qx^2 - qy^2 - qz^2) + 2*dy*qw*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 + qy^2 - qz^2)) + vz*(2*dx*qw*(2*qw*qy - 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dx*qx*(2*qw*qz + 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dy*qz*(2*qw*qx + 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dz*qz*(2*qw*qx - 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dy*qy*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 + qy^2 - qz^2) - 2*dz*qy*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 - qy^2 + qz^2)) + vy*(4*dz*qy*(2*qw*qx - 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 4*dx*qw*(2*qw*qz + 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 4*dy*qz*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 + qy^2 - qz^2))))/(abs(qw)^2 + abs(qx)^2 + abs(qy)^2 + abs(qz)^2)^(3/2), ((qz^2/(abs(qw)^2 + abs(qx)^2 + abs(qy)^2 + abs(qz)^2) - 1)*(vx*(2*dx*qz*(2*qw*qz + 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dz*qx*(2*qw*qx - 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dy*qz*(2*qw*qz - 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dz*qy*(2*qw*qy + 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dx*qw*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 + qx^2 - qy^2 - qz^2) + 2*dy*qw*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 + qy^2 - qz^2)) + vz*(2*dx*qw*(2*qw*qy - 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dx*qx*(2*qw*qz + 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dy*qz*(2*qw*qx + 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dz*qz*(2*qw*qx - 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dy*qy*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 + qy^2 - qz^2) - 2*dz*qy*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 - qy^2 + qz^2)) + vy*(4*dz*qy*(2*qw*qx - 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 4*dx*qw*(2*qw*qz + 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 4*dy*qz*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 + qy^2 - qz^2))))/(abs(qw)^2 + abs(qx)^2 + abs(qy)^2 + abs(qz)^2)^(1/2) + (qw*qz*(vx*(2*dy*qw*(2*qw*qz - 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dx*qw*(2*qw*qz + 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dz*qx*(2*qw*qy + 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dz*qy*(2*qw*qx - 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dx*qz*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 + qx^2 - qy^2 - qz^2) + 2*dy*qz*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 + qy^2 - qz^2)) + vz*(2*dx*qy*(2*qw*qz + 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dy*qw*(2*qw*qx + 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dz*qw*(2*qw*qx - 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dx*qz*(2*qw*qy - 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dy*qx*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 + qy^2 - qz^2) + 2*dz*qx*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 - qy^2 + qz^2)) - vy*(4*dx*qz*(2*qw*qz + 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 4*dz*qx*(2*qw*qx - 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 4*dy*qw*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 + qy^2 - qz^2))))/(abs(qw)^2 + abs(qx)^2 + abs(qy)^2 + abs(qz)^2)^(3/2) - (qx*qz*(vx*(2*dx*qx*(2*qw*qz + 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dy*qx*(2*qw*qz - 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dz*qw*(2*qw*qy + 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dz*qz*(2*qw*qx - 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dx*qy*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 + qx^2 - qy^2 - qz^2) + 2*dy*qy*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 + qy^2 - qz^2)) - vz*(2*dx*qy*(2*qw*qy - 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dy*qx*(2*qw*qx + 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dx*qz*(2*qw*qz + 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dz*qx*(2*qw*qx - 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dy*qw*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 + qy^2 - qz^2) + 2*dz*qw*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 - qy^2 + qz^2)) + vy*(4*dx*qy*(2*qw*qz + 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 4*dz*qw*(2*qw*qx - 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 4*dy*qx*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 + qy^2 - qz^2))))/(abs(qw)^2 + abs(qx)^2 + abs(qy)^2 + abs(qz)^2)^(3/2) - (qy*qz*(vz*(2*dy*qy*(2*qw*qx + 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dx*qx*(2*qw*qy - 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dx*qw*(2*qw*qz + 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dz*qy*(2*qw*qx - 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dy*qz*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 + qy^2 - qz^2) + 2*dz*qz*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 - qy^2 + qz^2)) - vx*(2*dx*qy*(2*qw*qz + 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dz*qw*(2*qw*qx - 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dy*qy*(2*qw*qz - 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dz*qz*(2*qw*qy + 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dx*qx*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 + qx^2 - qy^2 - qz^2) - 2*dy*qx*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 + qy^2 - qz^2)) + vy*(4*dx*qx*(2*qw*qz + 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 4*dz*qz*(2*qw*qx - 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 4*dy*qy*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 + qy^2 - qz^2))))/(abs(qw)^2 + abs(qx)^2 + abs(qy)^2 + abs(qz)^2)^(3/2);
 ((qw^2/(abs(qw)^2 + abs(qx)^2 + abs(qy)^2 + abs(qz)^2) - 1)*(vx*(2*dx*qw*(2*qw*qy - 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dy*qx*(2*qw*qz - 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dz*qw*(2*qw*qy + 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dy*qz*(2*qw*qx + 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dx*qy*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 + qx^2 - qy^2 - qz^2) - 2*dz*qy*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 - qy^2 + qz^2)) + vy*(2*dx*qy*(2*qw*qz + 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dy*qw*(2*qw*qx + 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dz*qw*(2*qw*qx - 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dx*qz*(2*qw*qy - 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dy*qx*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 + qy^2 - qz^2) + 2*dz*qx*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 - qy^2 + qz^2)) - vz*(4*dx*qy*(2*qw*qy - 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 4*dy*qx*(2*qw*qx + 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 4*dz*qw*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 - qy^2 + qz^2))))/(abs(qw)^2 + abs(qx)^2 + abs(qy)^2 + abs(qz)^2)^(1/2) + (qw*qx*(vy*(2*dx*qy*(2*qw*qy - 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dy*qx*(2*qw*qx + 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dx*qz*(2*qw*qz + 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dz*qx*(2*qw*qx - 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dy*qw*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 + qy^2 - qz^2) + 2*dz*qw*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 - qy^2 + qz^2)) + vx*(2*dx*qx*(2*qw*qy - 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dy*qw*(2*qw*qz - 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dy*qy*(2*qw*qx + 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dz*qx*(2*qw*qy + 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dx*qz*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 + qx^2 - qy^2 - qz^2) - 2*dz*qz*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 - qy^2 + qz^2)) + vz*(4*dx*qz*(2*qw*qy - 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 4*dy*qw*(2*qw*qx + 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 4*dz*qx*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 - qy^2 + qz^2))))/(abs(qw)^2 + abs(qx)^2 + abs(qy)^2 + abs(qz)^2)^(3/2) - (qw*qy*(vx*(2*dx*qy*(2*qw*qy - 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dy*qx*(2*qw*qx + 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dy*qz*(2*qw*qz - 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dz*qy*(2*qw*qy + 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dx*qw*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 + qx^2 - qy^2 - qz^2) + 2*dz*qw*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 - qy^2 + qz^2)) + vy*(2*dy*qy*(2*qw*qx + 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dx*qx*(2*qw*qy - 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dx*qw*(2*qw*qz + 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dz*qy*(2*qw*qx - 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dy*qz*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 + qy^2 - qz^2) + 2*dz*qz*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 - qy^2 + qz^2)) + vz*(4*dx*qw*(2*qw*qy - 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 4*dy*qz*(2*qw*qx + 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 4*dz*qy*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 - qy^2 + qz^2))))/(abs(qw)^2 + abs(qx)^2 + abs(qy)^2 + abs(qz)^2)^(3/2) - (qw*qz*(vx*(2*dx*qz*(2*qw*qy - 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dy*qw*(2*qw*qx + 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dy*qy*(2*qw*qz - 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dz*qz*(2*qw*qy + 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dx*qx*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 + qx^2 - qy^2 - qz^2) + 2*dz*qx*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 - qy^2 + qz^2)) - vy*(2*dx*qw*(2*qw*qy - 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dx*qx*(2*qw*qz + 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dy*qz*(2*qw*qx + 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dz*qz*(2*qw*qx - 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dy*qy*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 + qy^2 - qz^2) - 2*dz*qy*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 - qy^2 + qz^2)) + vz*(4*dy*qy*(2*qw*qx + 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 4*dx*qx*(2*qw*qy - 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 4*dz*qz*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 - qy^2 + qz^2))))/(abs(qw)^2 + abs(qx)^2 + abs(qy)^2 + abs(qz)^2)^(3/2), ((qx^2/(abs(qw)^2 + abs(qx)^2 + abs(qy)^2 + abs(qz)^2) - 1)*(vy*(2*dx*qy*(2*qw*qy - 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dy*qx*(2*qw*qx + 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dx*qz*(2*qw*qz + 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dz*qx*(2*qw*qx - 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dy*qw*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 + qy^2 - qz^2) + 2*dz*qw*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 - qy^2 + qz^2)) + vx*(2*dx*qx*(2*qw*qy - 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dy*qw*(2*qw*qz - 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dy*qy*(2*qw*qx + 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dz*qx*(2*qw*qy + 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dx*qz*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 + qx^2 - qy^2 - qz^2) - 2*dz*qz*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 - qy^2 + qz^2)) + vz*(4*dx*qz*(2*qw*qy - 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 4*dy*qw*(2*qw*qx + 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 4*dz*qx*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 - qy^2 + qz^2))))/(abs(qw)^2 + abs(qx)^2 + abs(qy)^2 + abs(qz)^2)^(1/2) + (qw*qx*(vx*(2*dx*qw*(2*qw*qy - 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dy*qx*(2*qw*qz - 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dz*qw*(2*qw*qy + 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dy*qz*(2*qw*qx + 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dx*qy*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 + qx^2 - qy^2 - qz^2) - 2*dz*qy*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 - qy^2 + qz^2)) + vy*(2*dx*qy*(2*qw*qz + 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dy*qw*(2*qw*qx + 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dz*qw*(2*qw*qx - 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dx*qz*(2*qw*qy - 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dy*qx*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 + qy^2 - qz^2) + 2*dz*qx*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 - qy^2 + qz^2)) - vz*(4*dx*qy*(2*qw*qy - 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 4*dy*qx*(2*qw*qx + 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 4*dz*qw*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 - qy^2 + qz^2))))/(abs(qw)^2 + abs(qx)^2 + abs(qy)^2 + abs(qz)^2)^(3/2) - (qx*qy*(vx*(2*dx*qy*(2*qw*qy - 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dy*qx*(2*qw*qx + 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dy*qz*(2*qw*qz - 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dz*qy*(2*qw*qy + 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dx*qw*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 + qx^2 - qy^2 - qz^2) + 2*dz*qw*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 - qy^2 + qz^2)) + vy*(2*dy*qy*(2*qw*qx + 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dx*qx*(2*qw*qy - 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dx*qw*(2*qw*qz + 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dz*qy*(2*qw*qx - 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dy*qz*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 + qy^2 - qz^2) + 2*dz*qz*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 - qy^2 + qz^2)) + vz*(4*dx*qw*(2*qw*qy - 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 4*dy*qz*(2*qw*qx + 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 4*dz*qy*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 - qy^2 + qz^2))))/(abs(qw)^2 + abs(qx)^2 + abs(qy)^2 + abs(qz)^2)^(3/2) - (qx*qz*(vx*(2*dx*qz*(2*qw*qy - 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dy*qw*(2*qw*qx + 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dy*qy*(2*qw*qz - 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dz*qz*(2*qw*qy + 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dx*qx*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 + qx^2 - qy^2 - qz^2) + 2*dz*qx*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 - qy^2 + qz^2)) - vy*(2*dx*qw*(2*qw*qy - 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dx*qx*(2*qw*qz + 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dy*qz*(2*qw*qx + 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dz*qz*(2*qw*qx - 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dy*qy*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 + qy^2 - qz^2) - 2*dz*qy*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 - qy^2 + qz^2)) + vz*(4*dy*qy*(2*qw*qx + 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 4*dx*qx*(2*qw*qy - 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 4*dz*qz*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 - qy^2 + qz^2))))/(abs(qw)^2 + abs(qx)^2 + abs(qy)^2 + abs(qz)^2)^(3/2), (qw*qy*(vx*(2*dx*qw*(2*qw*qy - 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dy*qx*(2*qw*qz - 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dz*qw*(2*qw*qy + 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dy*qz*(2*qw*qx + 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dx*qy*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 + qx^2 - qy^2 - qz^2) - 2*dz*qy*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 - qy^2 + qz^2)) + vy*(2*dx*qy*(2*qw*qz + 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dy*qw*(2*qw*qx + 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dz*qw*(2*qw*qx - 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dx*qz*(2*qw*qy - 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dy*qx*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 + qy^2 - qz^2) + 2*dz*qx*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 - qy^2 + qz^2)) - vz*(4*dx*qy*(2*qw*qy - 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 4*dy*qx*(2*qw*qx + 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 4*dz*qw*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 - qy^2 + qz^2))))/(abs(qw)^2 + abs(qx)^2 + abs(qy)^2 + abs(qz)^2)^(3/2) - ((qy^2/(abs(qw)^2 + abs(qx)^2 + abs(qy)^2 + abs(qz)^2) - 1)*(vx*(2*dx*qy*(2*qw*qy - 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dy*qx*(2*qw*qx + 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dy*qz*(2*qw*qz - 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dz*qy*(2*qw*qy + 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dx*qw*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 + qx^2 - qy^2 - qz^2) + 2*dz*qw*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 - qy^2 + qz^2)) + vy*(2*dy*qy*(2*qw*qx + 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dx*qx*(2*qw*qy - 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dx*qw*(2*qw*qz + 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dz*qy*(2*qw*qx - 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dy*qz*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 + qy^2 - qz^2) + 2*dz*qz*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 - qy^2 + qz^2)) + vz*(4*dx*qw*(2*qw*qy - 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 4*dy*qz*(2*qw*qx + 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 4*dz*qy*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 - qy^2 + qz^2))))/(abs(qw)^2 + abs(qx)^2 + abs(qy)^2 + abs(qz)^2)^(1/2) + (qx*qy*(vy*(2*dx*qy*(2*qw*qy - 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dy*qx*(2*qw*qx + 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dx*qz*(2*qw*qz + 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dz*qx*(2*qw*qx - 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dy*qw*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 + qy^2 - qz^2) + 2*dz*qw*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 - qy^2 + qz^2)) + vx*(2*dx*qx*(2*qw*qy - 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dy*qw*(2*qw*qz - 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dy*qy*(2*qw*qx + 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dz*qx*(2*qw*qy + 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dx*qz*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 + qx^2 - qy^2 - qz^2) - 2*dz*qz*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 - qy^2 + qz^2)) + vz*(4*dx*qz*(2*qw*qy - 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 4*dy*qw*(2*qw*qx + 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 4*dz*qx*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 - qy^2 + qz^2))))/(abs(qw)^2 + abs(qx)^2 + abs(qy)^2 + abs(qz)^2)^(3/2) - (qy*qz*(vx*(2*dx*qz*(2*qw*qy - 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dy*qw*(2*qw*qx + 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dy*qy*(2*qw*qz - 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dz*qz*(2*qw*qy + 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dx*qx*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 + qx^2 - qy^2 - qz^2) + 2*dz*qx*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 - qy^2 + qz^2)) - vy*(2*dx*qw*(2*qw*qy - 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dx*qx*(2*qw*qz + 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dy*qz*(2*qw*qx + 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dz*qz*(2*qw*qx - 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dy*qy*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 + qy^2 - qz^2) - 2*dz*qy*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 - qy^2 + qz^2)) + vz*(4*dy*qy*(2*qw*qx + 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 4*dx*qx*(2*qw*qy - 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 4*dz*qz*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 - qy^2 + qz^2))))/(abs(qw)^2 + abs(qx)^2 + abs(qy)^2 + abs(qz)^2)^(3/2), (qw*qz*(vx*(2*dx*qw*(2*qw*qy - 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dy*qx*(2*qw*qz - 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dz*qw*(2*qw*qy + 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dy*qz*(2*qw*qx + 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dx*qy*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 + qx^2 - qy^2 - qz^2) - 2*dz*qy*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 - qy^2 + qz^2)) + vy*(2*dx*qy*(2*qw*qz + 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dy*qw*(2*qw*qx + 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dz*qw*(2*qw*qx - 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dx*qz*(2*qw*qy - 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dy*qx*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 + qy^2 - qz^2) + 2*dz*qx*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 - qy^2 + qz^2)) - vz*(4*dx*qy*(2*qw*qy - 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 4*dy*qx*(2*qw*qx + 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 4*dz*qw*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 - qy^2 + qz^2))))/(abs(qw)^2 + abs(qx)^2 + abs(qy)^2 + abs(qz)^2)^(3/2) - ((qz^2/(abs(qw)^2 + abs(qx)^2 + abs(qy)^2 + abs(qz)^2) - 1)*(vx*(2*dx*qz*(2*qw*qy - 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dy*qw*(2*qw*qx + 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dy*qy*(2*qw*qz - 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dz*qz*(2*qw*qy + 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dx*qx*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 + qx^2 - qy^2 - qz^2) + 2*dz*qx*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 - qy^2 + qz^2)) - vy*(2*dx*qw*(2*qw*qy - 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dx*qx*(2*qw*qz + 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dy*qz*(2*qw*qx + 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dz*qz*(2*qw*qx - 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dy*qy*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 + qy^2 - qz^2) - 2*dz*qy*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 - qy^2 + qz^2)) + vz*(4*dy*qy*(2*qw*qx + 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 4*dx*qx*(2*qw*qy - 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 4*dz*qz*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 - qy^2 + qz^2))))/(abs(qw)^2 + abs(qx)^2 + abs(qy)^2 + abs(qz)^2)^(1/2) + (qx*qz*(vy*(2*dx*qy*(2*qw*qy - 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dy*qx*(2*qw*qx + 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dx*qz*(2*qw*qz + 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dz*qx*(2*qw*qx - 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dy*qw*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 + qy^2 - qz^2) + 2*dz*qw*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 - qy^2 + qz^2)) + vx*(2*dx*qx*(2*qw*qy - 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dy*qw*(2*qw*qz - 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dy*qy*(2*qw*qx + 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dz*qx*(2*qw*qy + 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dx*qz*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 + qx^2 - qy^2 - qz^2) - 2*dz*qz*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 - qy^2 + qz^2)) + vz*(4*dx*qz*(2*qw*qy - 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 4*dy*qw*(2*qw*qx + 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 4*dz*qx*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 - qy^2 + qz^2))))/(abs(qw)^2 + abs(qx)^2 + abs(qy)^2 + abs(qz)^2)^(3/2) - (qy*qz*(vx*(2*dx*qy*(2*qw*qy - 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dy*qx*(2*qw*qx + 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dy*qz*(2*qw*qz - 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dz*qy*(2*qw*qy + 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dx*qw*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 + qx^2 - qy^2 - qz^2) + 2*dz*qw*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 - qy^2 + qz^2)) + vy*(2*dy*qy*(2*qw*qx + 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dx*qx*(2*qw*qy - 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 2*dx*qw*(2*qw*qz + 2*qx*qy)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dz*qy*(2*qw*qx - 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 2*dy*qz*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 + qy^2 - qz^2) + 2*dz*qz*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 - qy^2 + qz^2)) + vz*(4*dx*qw*(2*qw*qy - 2*qx*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) + 4*dy*qz*(2*qw*qx + 2*qy*qz)*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2) - 4*dz*qy*(abs(vx)^2 + abs(vy)^2 + abs(vz)^2)^(1/2)*(qw^2 - qx^2 - qy^2 + qz^2))))/(abs(qw)^2 + abs(qx)^2 + abs(qy)^2 + abs(qz)^2)^(3/2)];
 
ddv_dq=-(ddc_dq-ddrg_q)/m;

A = [zeros(3),   zeros(3,4), ddp_dv;...
     zeros(4,3), ddq_dq,     zeros(4,3);...
     zeros(3) ,  ddv_dq,     ddrg_v];
B = [zeros(3), zeros(3,1);...
       ddq_dw, zeros(4,1);...
       zeros(3),    ddv_dc];
end